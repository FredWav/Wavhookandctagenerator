<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Inscription – Wav Generator</title>
  <!-- Tailwind CDN + config -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            accent:  '#7b2cff',
            'accent-2': '#00e7ff',
            panel:    '#12121b',
            'panel-2': '#161627',
            muted:    '#8b90a1',
            text:     '#e6e8ef',
            danger:   '#ff3b3b',
            success:  '#1ad199',
            warning:  '#ffcc00',
          },
          borderRadius: {
            'xl': '20px',
          },
          boxShadow: {
            'neon': '0 20px 60px rgba(0,0,0,.4)',
          },
        }
      }
    }
  </script>
  <!-- Fonts Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body {
      background:
      radial-gradient(800px 400px at 10% -10%, rgba(0,231,255,.15), transparent 60%),
      radial-gradient(800px 400px at 110% 10%, rgba(123,44,255,.15), transparent 60%),
      #0b0b11;
    }
  </style>
</head>
<body class="font-sans text-text min-h-screen flex items-center justify-center">
<main class="w-full max-w-md mx-auto px-6 py-10">
  <div class="rounded-2xl shadow-neon border border-white/10 bg-[radial-gradient(800px_400px_at_-10%_10%,rgba(0,231,255,0.12),transparent_60%),radial-gradient(800px_400px_at_110%_0%,rgba(123,44,255,0.12),transparent_60%),linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01))] p-8">
    <div class="flex items-center gap-2 font-bold text-lg mb-8">
      <span class="w-3 h-3 rounded-full bg-gradient-to-br from-accent-2 to-accent shadow-[0_0_12px_#00e7ff,0_0_24px_#7b2cff]"></span>
      Wav Generator
    </div>
    <h1 class="text-3xl font-extrabold leading-tight mb-4">Créer un compte</h1>
    <div class="h-px bg-white/10 mb-8"></div>
    
    <form id="form" class="flex flex-col gap-5">
      <!-- Pseudo -->
      <div>
        <label class="block text-xs text-muted mb-2">Pseudo</label>
        <input 
          id="username"
          class="w-full px-4 py-3 rounded-xl text-text bg-panel border border-white/10 outline-none transition-all duration-200 focus:border-accent focus:ring-2 focus:ring-accent/30 placeholder:text-muted/60"
          type="text" 
          name="username" 
          placeholder="Votre nom d'utilisateur" 
          required
          minlength="3"
          maxlength="20"
        />
        <p class="text-xs text-muted mt-1">3-20 caractères, lettres et chiffres uniquement</p>
      </div>

      <!-- Email -->
      <div>
        <label class="block text-xs text-muted mb-2">Email</label>
        <input 
          id="email"
          class="w-full px-4 py-3 rounded-xl text-text bg-panel border border-white/10 outline-none transition-all duration-200 focus:border-accent focus:ring-2 focus:ring-accent/30 placeholder:text-muted/60"
          type="email" 
          name="email" 
          placeholder="votre@email.com" 
          required
        />
      </div>

      <!-- Mot de passe -->
      <div>
        <label class="block text-xs text-muted mb-2">Mot de passe</label>
        <input 
          id="password"
          class="w-full px-4 py-3 rounded-xl text-text bg-panel border border-white/10 outline-none transition-all duration-200 focus:border-accent focus:ring-2 focus:ring-accent/30 placeholder:text-muted/60"
          type="password" 
          name="password" 
          placeholder="Mot de passe sécurisé" 
          required
          minlength="8"
        />
        <p class="text-xs text-muted mt-1">Minimum 8 caractères</p>
      </div>

      <!-- Confirmation mot de passe -->
      <div>
        <label class="block text-xs text-muted mb-2">Confirmer le mot de passe</label>
        <input 
          id="confirmPassword"
          class="w-full px-4 py-3 rounded-xl text-text bg-panel border border-white/10 outline-none transition-all duration-200 focus:border-accent focus:ring-2 focus:ring-accent/30 placeholder:text-muted/60"
          type="password" 
          name="confirmPassword" 
          placeholder="Retapez votre mot de passe" 
          required
        />
        <div id="passwordMatchError" class="text-xs text-danger mt-1 hidden">
          Les mots de passe ne correspondent pas
        </div>
      </div>

      <!-- Conditions d'utilisation -->
      <label class="flex items-start gap-3 cursor-pointer">
        <input 
          id="acceptTerms"
          type="checkbox" 
          class="mt-1 w-4 h-4 text-accent bg-transparent border-2 border-white/20 rounded focus:ring-accent/50 focus:ring-2"
          required
        />
        <span class="text-sm">
          J'accepte les 
          <a href="/terms" class="text-accent-2 hover:underline" target="_blank">conditions d'utilisation</a>
          et la 
          <a href="/privacy" class="text-accent-2 hover:underline" target="_blank">politique de confidentialité</a>
        </span>
      </label>

      <!-- Bouton d'inscription -->
      <button 
        id="submitBtn"
        class="inline-flex items-center justify-center gap-2 px-6 py-3 text-sm font-semibold text-[#0a0a10] bg-gradient-to-r from-accent to-accent-2 rounded-xl shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 transition-all duration-200"
        type="submit"
      >
        S'inscrire
      </button>
      
      <p class="text-xs text-muted text-center">
        Déjà inscrit ? <a href="/login" class="underline hover:text-accent-2">Se connecter</a>
      </p>
    </form>
  </div>
</main>

<script src="/app.js"></script>
<script>
document.getElementById("form").addEventListener("submit", async (e) => {
  e.preventDefault();
  
  const submitBtn = document.getElementById('submitBtn');
  const originalText = submitBtn.textContent;
  const passwordMatchError = document.getElementById('passwordMatchError');
  
  // Récupérer les valeurs
  const username = document.getElementById('username').value.trim();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
  const acceptTerms = document.getElementById('acceptTerms').checked;
  
  // Validation côté client
  passwordMatchError.classList.add('hidden');
  
  if (!username || !email || !password || !confirmPassword) {
    toast('Tous les champs sont obligatoires', 'error');
    return;
  }
  
  if (username.length < 3 || username.length > 20) {
    toast('Le pseudo doit contenir entre 3 et 20 caractères', 'error');
    return;
  }
  
  if (!/^[a-zA-Z0-9_]+$/.test(username)) {
    toast('Le pseudo ne peut contenir que des lettres, chiffres et underscore', 'error');
    return;
  }
  
  if (password.length < 8) {
    toast('Le mot de passe doit contenir au moins 8 caractères', 'error');
    return;
  }
  
  if (password !== confirmPassword) {
    passwordMatchError.classList.remove('hidden');
    toast('Les mots de passe ne correspondent pas', 'error');
    return;
  }
  
  if (!acceptTerms) {
    toast('Vous devez accepter les conditions d\'utilisation', 'error');
    return;
  }
  
  // État de chargement
  submitBtn.disabled = true;
  submitBtn.innerHTML = `
    <svg class="animate-spin -ml-1 mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
    Inscription...
  `;
  
  try {
    await api("auth/signup", {
      method: "POST", 
      body: { username, email, password }
    });
    
    toast('Inscription réussie ! Redirection...', 'success');
    setTimeout(() => {
      location.href = "/";
    }, 1500);
    
  } catch (err) {
    toast(err.message || "Erreur d'inscription", "error");
  } finally {
    // Restaurer le bouton
    submitBtn.disabled = false;
    submitBtn.textContent = originalText;
  }
});

// Vérification en temps réel des mots de passe
document.getElementById('confirmPassword').addEventListener('input', (e) => {
  const password = document.getElementById('password').value;
  const confirmPassword = e.target.value;
  const errorDiv = document.getElementById('passwordMatchError');
  
  if (confirmPassword && password !== confirmPassword) {
    errorDiv.classList.remove('hidden');
  } else {
    errorDiv.classList.add('hidden');
  }
});
</script>

<!-- Toast style -->
<style>
.toast {
  position: fixed;
  right: 18px;
  bottom: 18px;
  padding: 12px 16px;
  border-radius: 12px;
  background: #161627;
  border: 1px solid rgba(255,255,255,0.12);
  box-shadow: 0 20px 60px rgba(0,0,0,.4);
  max-width: 360px;
  color: #e6e8ef;
  z-index: 1000;
}

/* Styles pour les checkboxes */
input[type="checkbox"]:checked {
  background-color: #7b2cff;
  border-color: #7b2cff;
}
</style>
</body>
</html>
