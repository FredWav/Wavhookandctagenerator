// ===============================================
// PRINCIPALES CORRECTIONS JAVASCRIPT
// ===============================================

// 1. ‚úÖ NOUVELLE FONCTION DE S√âCURIT√â
function safeGet(obj, path, defaultValue = null) {
  try {
    return path.split('.').reduce((current, key) => current?.[key], obj) ?? defaultValue;
  } catch {
    return defaultValue;
  }
}

// 2. ‚úÖ GESTION D'ERREURS AM√âLIOR√âE
function showError(message, details = null) {
  if (window.loaderInterval) {
    clearInterval(window.loaderInterval);
  }
  
  document.getElementById('results').innerHTML = `
    <div class="error-message">
      <strong>‚ùå Erreur d'analyse :</strong> ${message}
      ${details ? `<br><small style="opacity: 0.8;">${details}</small>` : ''}
      <br><br>
      <div style="background: rgba(0,0,0,0.2); padding: 0.75rem; border-radius: 8px; margin-top: 1rem;">
        <strong>üí° Conseils de d√©pannage :</strong>
        <ul style="margin: 0.5rem 0 0 1rem; padding: 0;">
          <li>V√©rifiez que l'URL TikTok est correcte et compl√®te</li>
          <li>Assurez-vous que la vid√©o est publique (non priv√©e)</li>
          <li>R√©essayez dans quelques instants</li>
          <li>Utilisez le format : https://www.tiktok.com/@user/video/123456789</li>
        </ul>
      </div>
    </div>
  `;
}

// 3. ‚úÖ VALIDATION URL TIKTOK STRICTE (CORRIG√âE)
async function analyzeVideo(event) {
  event.preventDefault();
  
  const url = document.getElementById('videoUrl').value.trim();
  
  // üî• NOUVELLE VALIDATION STRICTE
  const tiktokPatterns = [
    /^https?:\/\/(www\.|vm\.|m\.)?tiktok\.com\/@[\w.-]+\/video\/\d+/,
    /^https?:\/\/vm\.tiktok\.com\/[\w]+/,
    /^https?:\/\/www\.tiktok\.com\/t\/[\w]+/
  ];
  
  const isValidTikTokUrl = tiktokPatterns.some(pattern => pattern.test(url));
  
  if (!isValidTikTokUrl) {
    showError(
      'URL TikTok invalide', 
      'Utilisez le format : https://www.tiktok.com/@username/video/123456789 ou un lien court vm.tiktok.com'
    );
    return;
  }
  
  // ... reste de la fonction
}

// 4. ‚úÖ GESTION ROBUSTE DES R√âPONSES API
try {
  const response = await fetch(API_ENDPOINT, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ url })
  });
  
  if (!response.ok) {
    let errorData;
    try {
      errorData = await response.json();
    } catch {
      errorData = { error: `Erreur HTTP ${response.status}` };
    }
    
    // üî• MESSAGES D'ERREUR PERSONNALIS√âS
    let userMessage = errorData.error || 'Erreur inconnue';
    let userDetails = null;
    
    switch (response.status) {
      case 400:
        userMessage = 'URL TikTok invalide ou incorrecte';
        userDetails = 'V√©rifiez le format de l\'URL et r√©essayez';
        break;
      case 404:
        userMessage = 'Vid√©o TikTok introuvable';
        userDetails = 'Cette vid√©o a peut-√™tre √©t√© supprim√©e ou est priv√©e';
        break;
      case 403:
        userMessage = 'Acc√®s interdit √† cette vid√©o';
        userDetails = 'La vid√©o est peut-√™tre g√©o-restreinte ou priv√©e';
        break;
      case 429:
        userMessage = 'Limite de requ√™tes atteinte';
        userDetails = 'Attendez quelques minutes avant de r√©essayer';
        break;
      case 500:
        userMessage = 'Erreur interne du serveur';
        userDetails = 'Nos serveurs rencontrent des difficult√©s, r√©essayez plus tard';
        break;
    }
    
    throw new Error(userMessage + (userDetails ? ` - ${userDetails}` : ''));
  }
} catch (error) {
  // üî• GESTION D'ERREURS R√âSEAU
  let errorMessage = error.message;
  let errorDetails = null;
  
  if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
    errorMessage = 'Impossible de contacter le serveur d\'analyse';
    errorDetails = 'V√©rifiez votre connexion internet et r√©essayez';
  }
  
  showError(errorMessage, errorDetails);
}

// 5. ‚úÖ AFFICHAGE S√âCURIS√â DES DONN√âES
function showResults(data
