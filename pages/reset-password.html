<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/images/WavSocialScan.svg" type="image/svg+xml" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- SEO Principal -->
    <title>Nouveau mot de passe - Wav Social Scan | Réinitialiser votre mot de passe</title>
    <meta
      name="description"
      content="Créez votre nouveau mot de passe sécurisé pour Wav Social Scan. Finalisez la réinitialisation de votre mot de passe pour retrouver l'accès à vos outils."
    />
    <meta
      name="keywords"
      content="nouveau mot de passe, réinitialiser mot de passe, wav social scan, reset password, sécurité compte"
    />
    <meta name="author" content="Gabizoc & Fred Wav" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://wavsocialscan.com/reset-password" />
    <meta
      property="og:title"
      content="Nouveau mot de passe - Wav Social Scan | Réinitialiser votre mot de passe"
    />
    <meta
      property="og:description"
      content="Créez votre nouveau mot de passe sécurisé pour Wav Social Scan."
    />
    <meta
      property="og:image"
      content="https://wavsocialscan.com/images/og-image.jpg"
    />
    <meta property="og:site_name" content="Wav Social Scan" />
    <meta property="og:locale" content="fr_FR" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://wavsocialscan.com/reset-password" />
    <meta
      name="twitter:title"
      content="Nouveau mot de passe - Wav Social Scan | Réinitialiser votre mot de passe"
    />
    <meta
      name="twitter:description"
      content="Créez votre nouveau mot de passe sécurisé pour Wav Social Scan."
    />
    <meta
      name="twitter:image"
      content="https://wavsocialscan.com/images/og-image.jpg"
    />

    <!-- Liens canoniques et robots -->
    <link rel="canonical" href="https://wavsocialscan.com/reset-password" />
    <meta name="robots" content="noindex, nofollow" />
    <meta name="googlebot" content="noindex, nofollow" />

    <!-- Tailwind CDN + config -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              accent: "#7b2cff",
              "accent-2": "#00e7ff",
              panel: "#12121b",
              "panel-2": "#161627",
              muted: "#8b90a1",
              text: "#e6e8ef",
              danger: "#ff3b3b",
              success: "#1ad199",
              warning: "#ffcc00",
            },
            borderRadius: {
              xl: "20px",
            },
            boxShadow: {
              neon: "0 20px 60px rgba(0,0,0,.4)",
            },
          },
        },
      };
    </script>
    <!-- Fonts Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        background: radial-gradient(
            800px 400px at 10% -10%,
            rgba(0, 231, 255, 0.15),
            transparent 60%
        ),
        radial-gradient(
            800px 400px at 110% 10%,
            rgba(123, 44, 255, 0.15),
            transparent 60%
        ),
        #0b0b11;
      }
      
      .password-strength-weak { border-color: #ff3b3b; }
      .password-strength-medium { border-color: #ffcc00; }
      .password-strength-strong { border-color: #1ad199; }
    </style>
  </head>
  <body
    class="font-sans text-text min-h-screen flex items-center justify-center"
  >
    <main class="w-full max-w-md mx-auto px-6 py-10">
      <div
        class="rounded-2xl shadow-neon border border-white/10 bg-[radial-gradient(800px_400px_at_-10%_10%,rgba(0,231,255,0.12),transparent_60%),radial-gradient(800px_400px_at_110%_0%,rgba(123,44,255,0.12),transparent_60%),linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01))] p-8"
      >
        <div class="flex items-center gap-2 font-bold text-lg mb-8">
          <img
            src="/images/WavSocialScan.svg"
            alt="Wav Social Scan Logo"
            class="w-8 h-8"
          />
          Wav Social Scan
        </div>
        <h1 class="text-3xl font-extrabold leading-tight mb-2">Nouveau mot de passe</h1>
        <p class="text-sm text-muted mb-4 leading-relaxed">
          Créez votre nouveau mot de passe sécurisé. Il doit contenir au minimum 8 caractères.
        </p>
        <div class="h-px bg-white/10 mb-8"></div>

        <!-- Messages de notification -->
        <div id="success-message" class="hidden mb-6 p-4 rounded-xl bg-success/10 border border-success/20 text-success text-sm">
          <div class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            Mot de passe réinitialisé avec succès ! Redirection vers la connexion...
          </div>
        </div>

        <div id="error-message" class="hidden mb-6 p-4 rounded-xl bg-danger/10 border border-danger/20 text-danger text-sm">
          <div class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
            <span id="error-text">Une erreur est survenue. Veuillez réessayer.</span>
          </div>
        </div>

        <form id="reset-password-form" class="flex flex-col gap-5">
          <div>
            <input
              class="w-full px-4 py-3 rounded-xl text-text bg-panel border border-white/10 outline-none transition-all duration-200 focus:border-accent focus:ring-2 focus:ring-accent/30 placeholder:text-muted/60"
              type="password"
              name="newPassword"
              id="newPassword"
              placeholder="Nouveau mot de passe"
              required
            />
            <p class="text-xs text-muted mt-2">Minimum 8 caractères</p>
          </div>
          
          <input
            class="w-full px-4 py-3 rounded-xl text-text bg-panel border border-white/10 outline-none transition-all duration-200 focus:border-accent focus:ring-2 focus:ring-accent/30 placeholder:text-muted/60"
            type="password"
            name="confirmPassword"
            id="confirmPassword"
            placeholder="Confirmer le mot de passe"
            required
          />
          
          <button
            class="inline-flex items-center justify-center gap-2 px-6 py-3 text-sm font-semibold text-[#0a0a10] bg-gradient-to-r from-accent to-accent-2 rounded-xl shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100"
            type="submit"
            id="submit-btn"
          >
            Réinitialiser le mot de passe
          </button>
          
          <p class="text-xs text-muted text-center">
            <a href="/login" class="underline hover:text-accent-2"
              >← Retour à la connexion</a
            >
          </p>
        </form>
      </div>
    </main>

    <script src="/app.js"></script>
    <script src="/components/loader.js"></script>
    <script>
      // Récupérer les paramètres de l'URL
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get('token');
      const email = urlParams.get('email');

      const form = document.getElementById('reset-password-form');
      const submitBtn = document.getElementById('submit-btn');
      const successMessage = document.getElementById('success-message');
      const errorMessage = document.getElementById('error-message');
      const errorText = document.getElementById('error-text');
      const newPasswordInput = document.getElementById('newPassword');
      const confirmPasswordInput = document.getElementById('confirmPassword');

      // Vérifier si le lien est valide
      if (!token || !email) {
        errorText.textContent = 'Lien invalide. Veuillez demander un nouveau lien de réinitialisation.';
        errorMessage.classList.remove('hidden');
        submitBtn.disabled = true;
      }

      function showMessage(message, type = 'error') {
        successMessage.classList.add('hidden');
        errorMessage.classList.add('hidden');
        
        if (type === 'success') {
          successMessage.classList.remove('hidden');
        } else {
          errorText.textContent = message;
          errorMessage.classList.remove('hidden');
        }
      }

      function validatePasswords() {
        const newPassword = newPasswordInput.value;
        const confirmPassword = confirmPasswordInput.value;

        if (newPassword.length < 8) {
          showMessage('Le mot de passe doit contenir au moins 8 caractères');
          return false;
        }

        if (newPassword !== confirmPassword) {
          showMessage('Les mots de passe ne correspondent pas');
          return false;
        }

        return true;
      }

      // Validation visuelle en temps réel pour la confirmation
      function updatePasswordMatch() {
        const newPassword = newPasswordInput.value;
        const confirmPassword = confirmPasswordInput.value;

        if (confirmPassword === '') {
          confirmPasswordInput.classList.remove('password-strength-weak', 'password-strength-strong');
          return;
        }

        if (newPassword === confirmPassword && newPassword.length >= 8) {
          confirmPasswordInput.classList.add('password-strength-strong');
          confirmPasswordInput.classList.remove('password-strength-weak');
        } else {
          confirmPasswordInput.classList.add('password-strength-weak');
          confirmPasswordInput.classList.remove('password-strength-strong');
        }
      }

      // Force de mot de passe
      function updatePasswordStrength() {
        const password = newPasswordInput.value;
        
        newPasswordInput.classList.remove('password-strength-weak', 'password-strength-medium', 'password-strength-strong');
        
        if (password.length === 0) return;
        
        if (password.length < 8) {
          newPasswordInput.classList.add('password-strength-weak');
        } else if (password.length >= 8 && password.length < 12) {
          newPasswordInput.classList.add('password-strength-medium');
        } else {
          newPasswordInput.classList.add('password-strength-strong');
        }
      }

      newPasswordInput.addEventListener('input', () => {
        updatePasswordStrength();
        updatePasswordMatch();
      });
      
      confirmPasswordInput.addEventListener('input', updatePasswordMatch);

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        successMessage.classList.add('hidden');
        errorMessage.classList.add('hidden');

        if (!validatePasswords()) {
          return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Réinitialisation...';

        const formData = new FormData(form);
        const data = {
          email: email,
          token: token,
          newPassword: formData.get('newPassword')
        };

        try {
          await api('auth/reset-password', {
            method: 'POST',
            body: data
          });

          showMessage('Mot de passe réinitialisé avec succès ! Redirection...', 'success');
          form.reset();
          
          // Rediriger vers la page de connexion après 3 secondes
          setTimeout(() => {
            window.location.href = '/login';
          }, 3000);
        } catch (err) {
          showMessage(err.message || 'Une erreur est survenue. Veuillez réessayer.');
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = 'Réinitialiser le mot de passe';
        }
      });
    </script>

    <!-- Toast style -->
    <style>
      .toast {
        position: fixed;
        right: 18px;
        bottom: 18px;
        padding: 12px 16px;
        border-radius: 12px;
        background: #161627;
        border: 1px solid rgba(255, 255, 255, 0.12);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        max-width: 360px;
        color: #e6e8ef;
        z-index: 1000;
      }
    </style>
  </body>
</html>
